@using FahasaStoreClientApp.Components
@{
    var currentUser = ViewData["CurrentUser"] as FahasaStoreClientApp.Models.DTO.AspNetUserDTO;
    var orders = ViewData["Orders"] as List<FahasaStoreClientApp.Models.DTO.OrderDTO>;
}

<div class="bg-black bg-opacity-10">
    <div class="container pt-4">
        <div class="bg-white rounded-3 py-3">
            <div class="row">
                <div class="col-lg-3">
                    @(await Html.RenderComponentAsync<SideBarUser>(RenderMode.ServerPrerendered, new { active = 0 }))
                </div>
                <div class="col-lg-9 px-4">
                    <h5 class="text-uppercase">Bảng điều khiển</h5><hr />
                    <div>
                        <div>
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h6 class="text-uppercase mb-0">Thông tin khách hàng</h6>
                                <a href="/User/Information" onclick="HandlerCRUD(this, event)" class="nav-link">Chỉnh sửa</a>
                            </div>
                            <div class="rounded-3 p-4" style="background-color: antiquewhite;">
                                <dl class="row px-4">
                                    <dt class="col-sm-3">
                                        Họ và tên
                                    </dt>
                                    <dd class="col-sm-9">
                                        @currentUser?.FullName
                                    </dd>
                                    <dt class="col-sm-3">
                                        Email
                                    </dt>
                                    <dd class="col-sm-9">
                                        @currentUser?.Email
                                    </dd>
                                    <dt class="col-sm-3">
                                        Số điện thoại
                                    </dt>
                                    <dd class="col-sm-9">
                                        @currentUser?.PhoneNumber
                                    </dd>
                                    <dt class="col-sm-3">
                                        Tổng số đơn hàng đã mua
                                    </dt>
                                    <dd class="col-sm-9">
                                        @currentUser?.Orders.Count
                                    </dd>
                                </dl>
                            </div>
                        </div> <hr />
                        <div>
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h6 class="text-uppercase mb-0">Những đơn hàng gần đây</h6>
                                <a href="#" class="nav-link">Xem tất cả</a>
                            </div>
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-1"><strong>#</strong></div>
                                    <div class="col-2"><strong>Ngày</strong></div>
                                    <div class="col-3"><strong>Người Nhận</strong></div>
                                    <div class="col-3"><strong>Thành Tiền</strong></div>
                                    <div class="col-2"><strong>Trạng Thái</strong></div>
                                    <div class="col-1"></div>
                                </div>
                                @{
                                    int i = 0;
                                    if (orders != null && orders.Count > 0)
                                    {
                                        foreach (var order in orders)
                                        {
                                            i = i + 1;
                                            <div class="row my-3">
                                                <div class="col-1">@i</div>
                                                <div class="col-2">@((order.CreatedAt != null) ? order.CreatedAt.Value.ToString("dd/MM/yyyy") : "Không có ngày tạo")</div>
                                                <div class="col-3">@order.Address.ReceiverName</div>
                                                <div class="col-3">@order.OrderItems.Sum(e => (e.Book.Price - e.Book.Price * e.Book.DiscountPercentage / 100) * e.Quantity).ToString("N0") đ</div>
                                                <div class="col-2">@order.OrderStatuses.LastOrDefault()?.Status.Name</div>
                                                <div class="col-1"><a href="/User/OrderDetail" IdValue="@order.Id" onclick="HandlerCRUD(this, event)" class="nav-link">Xem</a></div>
                                            </div>
                                        }
                                    }
                                }
                            </div>
                        </div> <hr />
                        <div>
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h6 class="text-uppercase mb-0">Sổ địa chỉ</h6>
                                <a href="#" class="nav-link">Xem thêm</a>
                            </div>
                            @{
                                if (currentUser != null && currentUser.Addresses.Count > 0)
                                {
                                    var address = currentUser.Addresses.FirstOrDefault(e => e.DefaultAddress == true);
                                    if (address != null)
                                    {
                                        <dl class="row px-4">
                                            <dt class="col-sm-3">
                                                Tên người nhận
                                            </dt>
                                            <dd class="col-sm-9">
                                                @address.ReceiverName
                                            </dd>
                                            <dt class="col-sm-3">
                                                Số điện thoại
                                            </dt>
                                            <dd class="col-sm-9">
                                                @address.Phone 033
                                            </dd>
                                            <dt class="col-sm-3">
                                                Địa chỉ
                                            </dt>
                                            <dd class="col-sm-9">
                                                @address.Detail , @address.Ward, @address.District , @address.Province
                                            </dd>
                                            <dt class="col-sm-3">
                                                Địa chỉ mặc định
                                            </dt>
                                            <dd class="col-sm-9">
                                                @if (address.DefaultAddress)
                                                {
                                                    <input checked type="checkbox" disabled />
                                                }
                                                else
                                                {
                                                    <input checked type="checkbox" />
                                                }
                                            </dd>
                                        </dl>
                                    }
                                }
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
