@using FahasaStoreClientApp.Components
@using FahasaStoreClientApp.Models.CustomModels
@using FahasaStoreClientApp.Models.DTO
@{
    ViewData["Title"] = "Trang Chủ";
    var banners = ViewData["Banners"] as List<BannerDTO>;
    var banners5 = new List<BannerDTO>();
    var banners2 = new List<BannerDTO>();
    var banners4 = new List<BannerDTO>();
    if (banners != null && banners.Count > 0)
    {
        var bannersCount = banners.Count;
        banners5 = bannersCount >= 6 ? banners.Skip(1).Take(5).ToList() : banners.Skip(1).Take(5).ToList();
        banners2 = bannersCount >= 8 ? banners.Skip(6).Take(2).ToList() : banners.Take(2).ToList();
        banners4 = bannersCount >= 12 ? banners.Skip(8).Take(4).ToList() : banners.Take(4).ToList();
    }

    var menus = ViewData["Menus"] as List<MenuDTO>;

    var flashSale = ViewData["FlashSale"] as List<FlashSaleBookDTO>;

    var trendOfMonth = ViewData["TrendOfMonth"] as List<BookDTO>;
    var trendOfYear = ViewData["TrendOfYear"] as List<BookDTO>;

    var topSellingBooksDefault =  ViewData["TopSellingBooksDefault"] as List<BookDTO>;

    var categories = ViewData["categories"] as List<CategoryDTO>;

    var partners = ViewData["Partners"] as List<PartnerDTO>;

    var pageFindSimilarBooksBasedOnCart = ViewData["pageFindSimilarBooksBasedOnCart"] as PaginatedResponse<BookDTO>;

}
<div class="bg-black bg-opacity-10 rounded-3">
    @* banner top *@
    <div class="container pt-3">
        <div class="row g-2">
            <div class="col-sm-8">
                <div id="carouselBanner" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-indicators">
                        @if(banners != null && banners.Count > 0) {
                            <button type="button" data-bs-target="#carouselBanner" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide @banners[0].Id"></button>
                        }
                        @{
                            if(banners5 != null && banners5.Count > 0) {
                                int slideTo = 0;
                                foreach(var item in banners5) {
                                    slideTo++;
                                    <button type="button" data-bs-target="#carouselBanner" data-bs-slide-to="@slideTo" aria-label="Slide @item.Id"></button>
                                }
                            }
                        }
                    </div>
                    <div class="carousel-inner rounded-3 overflow-hidden w-100">
                        @if (banners != null && banners.Count > 0)
                        {
                            <div class="carousel-item active" style="padding-bottom: 38%;">
                                <a href="/Home/Banner/@banners[0].Id">
                                    <img src="@banners[0].ImageUrl" class="w-100 h-100 position-absolute object-fit-cover" alt="slide @banners[0].Id">
                                </a>
                            </div>
                        }
                        
                        @{
                            if (banners5 != null && banners5.Count > 0)
                            {
                                foreach (var item in banners5)
                                {
                                    <div class="carousel-item" style="padding-bottom: 38%;">
                                        <a href="/Home/Banner/@item.Id">
                                            <img src="@item.ImageUrl" class="w-100 h-100 position-absolute object-fit-cover" alt="slide @item.Id">
                                        </a>
                                    </div>
                                }
                            }
                        }
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselBanner" data-bs-slide="prev">
                        <span class="bi-arrow-left-circle-fill" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselBanner" data-bs-slide="next">
                        <span class="bi-arrow-right-circle-fill" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
            <div class="d-none d-sm-block col-sm-4">
                @{
                    if (banners2 != null && banners2.Count > 0)
                    {
                        foreach(var item in banners2) {
                            <div class="h-50 w-100 pb-1">
                                <div class="position-relative w-100 h-100">
                                    <a href="/Home/Banner/@item.Id"><img src="@item.ImageUrl" class="rounded-3 w-100 h-100 position-absolute object-fit-cover" /></a>
                                </div>
                            </div>
                        }
                    }
                }
            </div>
        </div>
    </div>
    @* banner bottom *@
    <div class="container mt-4 d-none d-sm-block">
        <div class="row g-2">
            @{
                if (banners4 != null && banners4.Count > 0)
                {
                    foreach (var item in banners4)
                    {
                        <div class="col-3">
                            <a href="/Home/Banner/@item.Id" class="d-block position-relative h-100 w-100" style="padding-bottom: 66.67%;">
                                <img src="@item.ImageUrl" class="w-100 h-100 rounded-3 position-absolute" style="object-fit: cover;" />
                            </a>
                        </div>
                    }
                }
            }
        </div>
    </div>
    @* Menu *@
    <div class="container mt-4">
        <div class="menu bg-white rounded-3 py-4">
            @{
                if(menus != null && menus.Count > 0)
                {
                    foreach(var item in menus)
                    {
                        <div>
                            <div class="menu__item">
                                <a href="@item.Link" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="@item.Name">
                                    <div class="w-50 position-relative mx-auto" style="padding-bottom: 50%;">
                                        <img src="@item.ImageUrl" class="w-100 h-100 rounded-3 position-absolute" style="object-fit: cover;" />
                                    </div>
                                    <p class="m-0 text-center">@item.Name</p>
                                </a>
                            </div>
                        </div>
                    }
                }
            }
        </div>
    </div>
    @* flash sale *@
    <div class="mt-4" style="background-color: #ff6c6b;">
        <div class="container py-4">
            <div class="bg-white rounded-3 py-3 px-4 fw-bold d-flex align-items-center flex-wrap">
                <a href="" class="text-decoration-none">
                    <img src="~/image/label-flashsale.svg" width="130" height="26" class="object-fit-cover" />
                </a>
                <span class="mx-3">Kết thúc trong</span>
                <div class="d-flex align-items-center">
                    <span id="days" class="mx-2 p-2 text-white rounded-3 bg-black">00</span> :
                    <span id="hours" class="mx-2 p-2 text-white rounded-3 bg-black">00</span> :
                    <span id="minutes" class="mx-2 p-2 text-white rounded-3 bg-black">00</span> :
                    <span id="seconds" class="mx-2 p-2 text-white rounded-3 bg-black">00</span>
                </div>
                <a href="" class="ms-auto d-flex text-decoration-none"><span class="d-none d-md-block">Xem tất cả</span> <i class="bi bi-chevron-right"></i></a>
            </div>
            <div class="flashSaleMenu mt-4" countDownDate="@flashSale?.FirstOrDefault()?.FlashSale.EndDate">
                @{
                    if (flashSale != null && flashSale.Count > 0)
                    {
                        foreach (var item in flashSale)
                        {
                            @(await Html.RenderComponentAsync<RenderBookFlashSaleComponent>(RenderMode.ServerPrerendered, new { FlashSaleBook = item }))
                        }
                    }
                }
            </div>
        </div>
    </div>
    
    @{
        if (pageFindSimilarBooksBasedOnCart != null && pageFindSimilarBooksBasedOnCart.Items.Count > 0)
        {
            <div class="container mt-4">
                <div class="d-flex align-items-center p-3 rounded-top-3" style="background-color: #FCDDEF;">
                    <img src="~/image/icon_dealhot_new.png" width="32" height="32" class="object-fit-cover rounded-3" />
                    <h5 class="mb-0 p-2">Sản Phẩm Gợi Ý Cho Bạn</h5>
                </div>
                <div class="bg-white p-3 rounded-bottom-3">
                    <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 g-4 mt-1">
                        @foreach (var book in pageFindSimilarBooksBasedOnCart.Items)
                        {
                            <div>
                                <div class="card mx-2 position-relative overflow-hidden">
                                    <a href="/Home/Product/@book.Id" class="text-decoration-none mx-2" style="color: #000;" title="@book.Name">
                                        <div class="w-100 position-relative" style="padding-bottom: 100%;">
                                            <img src="@book.PosterImages.LastOrDefault()?.ImageUrl" class="card-img-top position-absolute w-100 h-100 object-fit-cover" alt="...">
                                        </div>
                                        <div class="card-body p-1">
                                            <h6 class="card-title twoLine">@book.Name</h6>
                                            <div class="d-flex flex-column justify-content-start">
                                                <div>
                                                    <span class="card-text text-danger fw-bold">@((book.Price - book.Price * book.DiscountPercentage / 100).ToString("N0")) đ</span>
                                                    <small class="position-absolute top-0 end-0 bg-danger text-white px-2 ms-2 rounded-start">- @book.DiscountPercentage %</small>
                                                </div>
                                                <small class="card-text text-decoration-line-through">@book.Price.ToString("N0") đ</small>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        }
                    </div>
                    <div class="text-center mt-3">
                        <a href="#" class="btn btn-outline-danger px-5">Xem Thêm</a>
                    </div>
                </div>
            </div>
        }
    }
    
    @* Shopping trends *@
    <div class="container mt-4">
        <div class="d-flex align-items-center p-3 rounded-top-3" style="background-color: #FCDDEF;">
            <img src="~/image/icon_dealhot_new.png" width="32" height="32" class="object-fit-cover rounded-3" />
            <h5 class="mb-0 p-2">Xu Hướng Mua Sắm</h5>
        </div>
        <div class="bg-white p-3 rounded-bottom-3">
            <ul class="nav nav-tabs" id="shoppingTrendsTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="trendOfMonth-tab" data-bs-toggle="tab" data-bs-target="#trendOfMonth-tab-pane" type="button" role="tab" aria-controls="trendOfMonth-tab-pane" aria-selected="false">
                        Xu Hướng Theo Tháng
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="trendOfYear-tab" data-bs-toggle="tab" data-bs-target="#trendOfYear-tab-pane" type="button" role="tab" aria-controls="trendOfYear-tab-pane" aria-selected="false">
                        Xu Hướng Theo Năm
                    </button>
                </li>
            </ul>
            <div class="tab-content" id="shoppingTrendsTab">
                <div class="tab-pane fade show active" id="trendOfMonth-tab-pane" role="tabpanel" aria-labelledby="trendOfMonth-tab" tabindex="0">
                    @await Html.PartialAsync("/Views/PartialViews/_BooksPartial.cshtml", trendOfMonth)
                </div>
                <div class="tab-pane fade" id="trendOfYear-tab-pane" role="tabpanel" aria-labelledby="trendOfYear-tab" tabindex="0">
                    @await Html.PartialAsync("/Views/PartialViews/_BooksPartial.cshtml", trendOfYear)
                </div>
            </div>
        </div>
    </div>
    @* Ranking sell *@
    <div class="container mt-4">
        <div class="p-3 bg-black rounded-top-3 d-flex align-items-center text-white">
            <img src="~/image/icon_dealhot_new.png" width="32" height="32" class="object-fit-cover rounded-3" />
            <h5 class="mb-0 p-2">Bảng Xếp Hạng bán Chạy Nhất</h5>
        </div>
        <div class="p-3 bg-white rounded-bottom-3">
            <ul class="nav nav-tabs mb-1" id="rankingTab">
                <li class="nav-item">
                    <button class="nav-link active" data-bs-toggle="tab" CategoryId="0">
                        Tất cả
                    </button>
                </li>
                @if (categories != null && categories.Count > 0)
                {
                    foreach (var category in categories)
                    {
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" CategoryId="@category.Id">
                                @category.Name
                            </button>
                        </li>
                    }
                }
            </ul>
            <div id="tab-content_rankingTab" class="tab-content"></div>
        </div>
    </div>

    @* Category book *@
    <div id="booksCategoryTab">
        @{
            if (categories != null && categories.Count > 0)
            {
                foreach (var category in categories)
                {
                    <div class="container mt-4">
                        <div class="d-flex align-items-center p-3 rounded-top-3 bg-white">
                            <img src="~/image/icon_dealhot_new.png" width="32" height="32" class="object-fit-cover rounded-3" />
                            <h5 class="fw-bold mb-0 p-2">@category.Name</h5>
                        </div>
                        <div class="bg-white p-3 rounded-bottom-3">
                            <ul class="nav nav-tabs mb-1 ul-Tabs">
                                <li class="nav-item">
                                    <button class="nav-link active" data-bs-toggle="tab" CategoryId="@category.Id">
                                        Tất cả
                                    </button>
                                </li>
                                @{
                                    if (category.Subcategories != null && category.Subcategories.Count > 0)
                                    {
                                        foreach (var subcategory in category.Subcategories.Take(5))
                                        {
                                            <li class="nav-item">
                                                <button class="nav-link" data-bs-toggle="tab" CategoryId="@category.Id" SubcategoryId="@subcategory.Id">
                                                    @subcategory.Name
                                                </button>
                                            </li>
                                        }
                                    }
                                }
                            </ul>
                            <div class="tab-content" id="tab-content_@category.Id"></div>
                        </div>
                    </div>
                }
            }
        }
    </div>
    
    @* trademark *@
    <div class="container mt-4">
        <div class="trade-mark rounded-3 bg-white py-3">
            @{
                if (partners != null && partners.Count > 0)
                {
                    foreach(var item in partners)
                    {
                        <div class="position-relative" style="padding-bottom: 100%;">
                            <a href="" class="position-absolute w-100 h-100">
                                <img src="@item.ImageUrl" class="object-fit-cover p-2 w-100 h-100" />
                            </a>
                        </div>
                    }
                }
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>

        // fast link
        $(document).ready(function () {
            $('.menu').slick({
                infinite: true,
                slidesToShow: 10,
                slidesToScroll: 10,
                arrows: false,
                responsive: [
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: 8,
                            slidesToScroll: 8,
                            infinite: true,
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: 6,
                            slidesToScroll: 6,
                            infinite: true,
                        }
                    },
                    {
                        breakpoint: 414,
                        settings: {
                            slidesToShow: 5,
                            slidesToScroll: 5,
                            infinite: true,
                        }
                    },
                ]
            });
        });
        // flash sale time diff
        $(document).ready(function () {
            var endDate = $(".flashSaleMenu").attr("countDownDate");
            var countDownDate = new Date(endDate).getTime();
            var x = setInterval(function () {
                var now = new Date().getTime();
                var distance = countDownDate - now;

                var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                var seconds = Math.floor((distance % (1000 * 60)) / 1000);

                $('#days').html(days);
                $('#hours').html(hours);
                $('#minutes').html(minutes);
                $('#seconds').html(seconds);

                if (distance < 0) {
                    clearInterval(x);
                    $('#days').html("00");
                    $('#hours').html("00");
                    $('#minutes').html("00");
                    $('#seconds').html("00");
                }
            }, 1000);
        });
        // flash sale menu
        $(document).ready(function () {
            $('.flashSaleMenu').slick({
                dots: false,
                infinite: false,
                speed: 300,
                slidesToShow: 5,
                slidesToScroll: 5,
                responsive: [
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: 4,
                            slidesToScroll: 4
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: 3,
                            slidesToScroll: 3
                        }
                    },
                    {
                        breakpoint: 576,
                        settings: {
                            slidesToShow: 2,
                            slidesToScroll: 2
                        }
                    },
                ]
            });
        });
        
        // trade mark
        $(document).ready(function () {
            $('.trade-mark').slick({
                infinite: true,
                slidesToShow: 9,
                slidesToScroll: 9,
                arrows: true,
                dots: false,
                autoplay: true,
                autoplaySpeed: 3000,
                swipeToSlide: false,
                responsive: [
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: 5,
                            slidesToScroll: 5,
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: 3,
                            slidesToScroll: 3,
                        }
                    }
                ]
            });
        });
    </script>
}
